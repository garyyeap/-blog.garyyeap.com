<!DOCTYPE html>
<html lang='en' dir='auto'><head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='@babel/plugin-transform-runtime main goal is to address some issues that arise from Polyfill, Helper, and Regenerator compilation. The following sections will introduce and explain the solutions to these problems one by one.
Polyfill People who work on web front-end development should be familiar with this term. If you look up this term in a dictionary, its explanation is some kind of filling material. Before the term Polyfill came into use, there was another term called Shim.'>
<meta name='theme-color' content='#444444'>

<meta property='og:title' content='Coding: Babel transform runtime explained • Indecision'>
<meta property='og:description' content='@babel/plugin-transform-runtime main goal is to address some issues that arise from Polyfill, Helper, and Regenerator compilation. The following sections will introduce and explain the solutions to these problems one by one.
Polyfill People who work on web front-end development should be familiar with this term. If you look up this term in a dictionary, its explanation is some kind of filling material. Before the term Polyfill came into use, there was another term called Shim.'>
<meta property='og:url' content='https://blog.garyyeap.com/en/coding/babel-transform-runtime-explained/'>
<meta property='og:site_name' content='Indecision'>
<meta property='og:type' content='article'><meta property='article:section' content='coding'><meta property='article:tag' content='javascript'><meta property='article:tag' content='babel'><meta property='article:tag' content='polyfill'><meta property='article:tag' content='es6'><meta property='article:tag' content='plugin-transform-runtime'><meta property='article:published_time' content='2024-08-25T00:00:00Z'/><meta property='article:modified_time' content='2024-08-25T00:00:00Z'/><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.82.1" />

  <title>Coding: Babel transform runtime explained • Indecision</title>
  <link rel='canonical' href='https://blog.garyyeap.com/en/coding/babel-transform-runtime-explained/'>
  
  
  <link rel='icon' href='/favicon.ico'>
<link rel='stylesheet' href='/assets/css/main.b6d96371.css'><style>
:root{--color-accent:#444444;}
</style>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-179143362-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  

</head>
<body class='page type-coding has-sidebar'>

  <div class='site'><div id='sidebar' class='sidebar'>
  <a class='screen-reader-text' href='#main-menu'>Skip to Main Menu</a>

  <div class='container'><section class='widget widget-about sep-after'>
  <header>
    
    <div class='logo'>
      <a href='/en/'>
        <img src='/images/logo.png'>
      </a>
    </div>
    
    <h2 class='title site-title '>
      <a href='/en/'>
      Indecision
      </a>
    </h2>
    <div class='desc'>
    Personal blog by Gary Yeap.
    </div>
  </header>

</section>

<section class='widget widget-sidebar_menu sep-after'><nav id='sidebar-menu' class='menu sidebar-menu' aria-label='Sidebar Menu'>
    <div class='container'>
      <ul><li class='item'>
  <a href='/en/coding/'>Coding</a></li></ul>
    </div>
  </nav>

</section><section class='widget widget-taxonomy_cloud sep-after'>
  <header>
    <h4 class='title widget-title'>Tags</h4>
  </header>

  <div class='container list-container'>
  <ul class='list taxonomy-cloud'><li>
        <a href='/en/tags/babel/' style='font-size:1em'>babel</a>
      </li><li>
        <a href='/en/tags/es6/' style='font-size:1em'>es6</a>
      </li><li>
        <a href='/en/tags/event-loop/' style='font-size:1em'>event loop</a>
      </li><li>
        <a href='/en/tags/javascript/' style='font-size:2em'>javascript</a>
      </li><li>
        <a href='/en/tags/plugin-transform-runtime/' style='font-size:1em'>plugin-transform-runtime</a>
      </li><li>
        <a href='/en/tags/polyfill/' style='font-size:1em'>polyfill</a>
      </li></ul>
</div>


</section>
</div>

  <div class='sidebar-overlay'></div>
</div><div class='main'><nav id='main-menu' class='menu main-menu' aria-label='Main Menu'>
  <div class='container'>
    <a class='screen-reader-text' href='#content'>Skip to Content</a>

<button id='sidebar-toggler' class='sidebar-toggler' aria-controls='sidebar'>
  <span class='screen-reader-text'>Toggle Sidebar</span>
  <span class='open'><svg class='icon' xmlns='http://www.w3.org/2000/svg' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    
  <line x1="3" y1="12" x2="21" y2="12" />
  <line x1="3" y1="6" x2="21" y2="6" />
  <line x1="3" y1="18" x2="21" y2="18" />

</svg>
</span>
  <span class='close'><svg class='icon' xmlns='http://www.w3.org/2000/svg' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    
  <line x1="18" y1="6" x2="6" y2="18" />
  <line x1="6" y1="6" x2="18" y2="18" />

</svg>
</span>
</button>
    <ul>
      <li>
        <a href="https://github.com/garyyeap/blog">
          <svg style="width: 24px;height: 24px;display: inline-block;line-height: 24px;vertical-align: middle;" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M7 5C7 3.89543 7.89543 3 9 3C10.1046 3 11 3.89543 11 5C11 5.74028 10.5978 6.38663 10 6.73244V14.0396H11.7915C12.8961 14.0396 13.7915 13.1441 13.7915 12.0396V10.7838C13.1823 10.4411 12.7708 9.78837 12.7708 9.03955C12.7708 7.93498 13.6662 7.03955 14.7708 7.03955C15.8753 7.03955 16.7708 7.93498 16.7708 9.03955C16.7708 9.77123 16.3778 10.4111 15.7915 10.7598V12.0396C15.7915 14.2487 14.0006 16.0396 11.7915 16.0396H10V17.2676C10.5978 17.6134 11 18.2597 11 19C11 20.1046 10.1046 21 9 21C7.89543 21 7 20.1046 7 19C7 18.2597 7.4022 17.6134 8 17.2676V6.73244C7.4022 6.38663 7 5.74028 7 5Z" fill="#000000"></path> </g></svg>
        </a>
      </li>
      
    
      
        <li><a href="https://blog.garyyeap.com/zh/">中文</a></li>
      
    
    </ul>
  </div>
</nav><div class='header-widgets'>
        <div class='container'>
    
    <style>.widget-breadcrumbs li:after{content:'\2f '}</style>
  <section class='widget widget-breadcrumbs sep-after'>
    <nav id='breadcrumbs'>
      <ol><li><a href='/en/'>Home</a></li><li><a href='/en/coding/'>Coding</a></li><li><span>Babel transform runtime explained</span></li></ol>
    </nav>
  </section></div>
      </div>

      <main id='content'>


<article lang='en' class='entry'>
  

<header class='header entry-header'>
  <div class='container sep-after'>
    <div class='header-info'>
      <h1 class='title'>Babel transform runtime explained</h1>
      

    </div>
    <div class='entry-meta'>
  <span class='posted-on'><svg class='icon' xmlns='http://www.w3.org/2000/svg' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
  <line x1="16" y1="2" x2="16" y2="6"/>
  <line x1="8" y1="2" x2="8" y2="6"/>
  <line x1="3" y1="10" x2="21" y2="10"/>

</svg>
<span class='screen-reader-text'>Posted on </span>
  <time class='entry-date' datetime='2024-08-25T00:00:00Z'>2024, Aug 25</time>
</span>

  
  
<span class='reading-time'><svg class='icon' xmlns='http://www.w3.org/2000/svg' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    
  <circle cx="12" cy="12" r="10"/>
  <polyline points="12 6 12 12 15 15"/>

</svg>
8 mins read
</span>


</div>


  </div>
</header>

  
  

  <div class='container entry-content'>
  <p><code>@babel/plugin-transform-runtime</code> main goal is to address some issues that arise from Polyfill, Helper, and Regenerator compilation. The following sections will introduce and explain the solutions to these problems one by one.</p>
<h2 id="polyfill">Polyfill</h2>
<p>People who work on web front-end development should be familiar with this term. If you look up this term in a dictionary, its explanation is some kind of filling material. Before the term Polyfill came into use, there was another term called Shim. What’s the difference between the two? For example, if there’s a hole in a wall and you use a board to cover it, that’s a Shim. If you use plaster to fill and smooth out the hole, that’s a Polyfill. The difference is that with the former, you can clearly see there’s a foreign object, while with the latter, you won’t feel any difference. In terms of code, if you need to solve the issue of different browsers handling the fullscreen API differently:</p>
<p>Shim(<a href="https://www.npmjs.com/package/easy-fullscreen">Source</a>)：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">Fullscreen</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;easy-fullscreen&#39;</span>;

<span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">Fullscreen</span>.<span style="color:#a6e22e">isEnabled</span>) {
  <span style="color:#a6e22e">fullscreenButton</span>.<span style="color:#a6e22e">onclick</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
    <span style="color:#75715e">// check if is in fullscreen mode
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">Fullscreen</span>.<span style="color:#a6e22e">isFullscreen</span>) {
      <span style="color:#75715e">// exit fullscreen
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">Fullscreen</span>.<span style="color:#a6e22e">exit</span>();
    } <span style="color:#66d9ef">else</span> {
      <span style="color:#75715e">// request to enter fullscreen
</span><span style="color:#75715e"></span>      <span style="color:#a6e22e">Fullscreen</span>.<span style="color:#a6e22e">request</span>(<span style="color:#a6e22e">fullscreenElement</span>);
    }
  };
}
</code></pre></div><p>Polyfill:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#39;core-js&#39;</span>;

<span style="color:#66d9ef">if</span> (document.<span style="color:#a6e22e">documentElement</span>.<span style="color:#a6e22e">requestFullscreen</span>) {
  <span style="color:#a6e22e">fullscreenButton</span>.<span style="color:#a6e22e">onclick</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
    <span style="color:#66d9ef">if</span> (document.<span style="color:#a6e22e">fullscreenElement</span>) {
      document.<span style="color:#a6e22e">exitFullscreen</span>();
    } <span style="color:#66d9ef">else</span> {
      document.<span style="color:#a6e22e">documentElement</span>.<span style="color:#a6e22e">requestFullscreen</span>();
    }
  };
}
</code></pre></div><p>Both can achieve fullscreen functionality, but the latter uses the standard API, while the former does not.</p>
<h4 id="global-polyfill">Global Polyfill</h4>
<p>This is actually the default mode of Babel:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">//import &#39;@babel/polyfill&#39;; //deprecated
</span><span style="color:#75715e"></span><span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#39;core-js&#39;</span>;

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">sym</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Symbol</span>();
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">promise</span> <span style="color:#f92672">=</span> Promise.<span style="color:#a6e22e">resolve</span>();
</code></pre></div><p>The principle is quite simple: manually import all Polyfills at the very beginning of the file. Since it is global, essentially, it only needs to be loaded in one file. The common practice is to import it in the entry file. The problem with the method shown in the example above is that it loads a bunch of Polyfills that are not actually used by the project or files. Therefore, core-js provides a more advanced approach:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#39;core-js/es/symbol&#39;</span>;
<span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#39;core-js/es/promise&#39;</span>;

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">sym</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Symbol</span>();
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">promise</span> <span style="color:#f92672">=</span> Promise.<span style="color:#a6e22e">resolve</span>();
</code></pre></div><p>Here&rsquo;s the translation:</p>
<hr>
<p>Managing these imports can be cumbersome. For example, if you no longer need <code>Promise</code>, it would be more space-efficient to remove it. However, when updating the code, it&rsquo;s easy to forget to remove or import certain things, leading to issues where everything works locally but breaks on older browsers in production. To address this, <code>@babel/preset-env</code> offers a feature with a <code>useBuiltIns</code> option. If you set it to <code>entry</code>, Babel will load the necessary Polyfills based on the browsers you want to support. It will transform:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#34;core-js&#34;</span>;
</code></pre></div><p>into (depending on the browser environment settings):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#34;core-js/modules/es.string.pad-start&#34;</span>;
<span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#34;core-js/modules/es.string.pad-end&#34;</span>;
</code></pre></div><p>If you set it to <code>usage</code>, it will only load the Polyfills used in the file. For example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">a</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Promise();
</code></pre></div><p>will be transformed into:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#39;core-js/es/promise&#39;</span>;

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">promise</span> <span style="color:#f92672">=</span> Promise.<span style="color:#a6e22e">resolve</span>();
</code></pre></div><p>But if the target browser environment already supports <code>Promise</code>, no Polyfill will be loaded, so it effectively does nothing:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">a</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Promise();
</code></pre></div><p>The advantage of global Polyfills is that, with the support of bundlers, a project will generally have only one instance of each Polyfill. The downside is that if used in packages, it pollutes the global namespace. If the project itself also uses Polyfills, it can lead to duplicate loading. Imagine a project using this approach and simultaneously using N packages that also follow this approach. In the worst-case scenario, the Polyfills could be loaded N+1 times, with the last one loaded overwriting the previous ones. If the implementations of the Polyfills differ (since it&rsquo;s global and doesn’t necessarily have to use core-js), this can lead to unpredictable issues.</p>
<p>Reference:</p>
<ol>
<li><a href="https://babeljs.io/docs/en/babel-preset-env#usebuiltins">https://babeljs.io/docs/en/babel-preset-env#usebuiltins</a></li>
<li><a href="https://babeljs.io/docs/en/babel-polyfill">https://babeljs.io/docs/en/babel-polyfill</a></li>
</ol>
<h4 id="scoped-es6-polyfill">Scoped ES6 Polyfill</h4>
<p>Due to the issues with the global mode mentioned earlier, Babel provides an alternative mode that requires using <code>@babel/plugin-transform-runtime</code> together with <code>@babel/runtime</code>:</p>
<p>Babel config:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">{
  <span style="color:#e6db74">&#34;plugins&#34;</span><span style="color:#f92672">:</span> [
    [
      <span style="color:#e6db74">&#34;@babel/plugin-transform-runtime&#34;</span>,
      {
        <span style="color:#e6db74">&#34;corejs&#34;</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>
      }
    ]
  ]
}
</code></pre></div><p>The principle behind it is to use the module features of ES6 to make Polyfills local variables:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">sym</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Symbol</span>();

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">promise</span> <span style="color:#f92672">=</span> Promise.<span style="color:#a6e22e">resolve</span>();

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">check</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">arr</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#e6db74">&#34;yeah!&#34;</span>);

<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">arr</span>[<span style="color:#a6e22e">Symbol</span>.<span style="color:#a6e22e">iterator</span>]());
</code></pre></div><p>transforms to:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">_getIterator</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;@babel/runtime-corejs3/core-js/get-iterator&#34;</span>;
<span style="color:#66d9ef">import</span> <span style="color:#a6e22e">_includesInstanceProperty</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;@babel/runtime-corejs3/core-js-stable/instance/includes&#34;</span>;
<span style="color:#66d9ef">import</span> <span style="color:#a6e22e">_Promise</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;@babel/runtime-corejs3/core-js-stable/promise&#34;</span>;
<span style="color:#66d9ef">import</span> <span style="color:#a6e22e">_Symbol</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;@babel/runtime-corejs3/core-js-stable/symbol&#34;</span>;

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">sym</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">_Symbol</span>();

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">promise</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">_Promise</span>.<span style="color:#a6e22e">resolve</span>();

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">check</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">_includesInstanceProperty</span>(<span style="color:#a6e22e">arr</span>).<span style="color:#a6e22e">call</span>(<span style="color:#a6e22e">arr</span>, <span style="color:#e6db74">&#34;yeah!&#34;</span>);

<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">_getIterator</span>(<span style="color:#a6e22e">arr</span>));
</code></pre></div><p>The advantage of this approach is that it doesn&rsquo;t pollute the global namespace, but it doesn&rsquo;t fully address the issue of code duplication, unless all the packages used in the project are using the same version of <code>runtime-corejs</code>.</p>
<p>Reference:</p>
<ol>
<li><a href="https://babeljs.io/docs/en/babel-runtime">https://babeljs.io/docs/en/babel-runtime</a></li>
<li><a href="https://babeljs.io/docs/en/babel-plugin-transform-runtime">https://babeljs.io/docs/en/babel-plugin-transform-runtime</a></li>
</ol>
<h2 id="helper">Helper</h2>
<p>Helper functions are pieces of code that Babel generates to support certain ES6 syntax features. For example, for an <code>async function</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">abc</span>() {}
</code></pre></div><p>Babel will transform it into:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#e6db74">&#34;use strict&#34;</span>;

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">asyncGeneratorStep</span>(<span style="color:#a6e22e">gen</span>, <span style="color:#a6e22e">resolve</span>, <span style="color:#a6e22e">reject</span>, <span style="color:#a6e22e">_next</span>, <span style="color:#a6e22e">_throw</span>, <span style="color:#a6e22e">key</span>, <span style="color:#a6e22e">arg</span>) { <span style="color:#66d9ef">try</span> { <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">info</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gen</span>[<span style="color:#a6e22e">key</span>](<span style="color:#a6e22e">arg</span>); <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">value</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">info</span>.<span style="color:#a6e22e">value</span>; } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) { <span style="color:#a6e22e">reject</span>(<span style="color:#a6e22e">error</span>); <span style="color:#66d9ef">return</span>; } <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">info</span>.<span style="color:#a6e22e">done</span>) { <span style="color:#a6e22e">resolve</span>(<span style="color:#a6e22e">value</span>); } <span style="color:#66d9ef">else</span> { Promise.<span style="color:#a6e22e">resolve</span>(<span style="color:#a6e22e">value</span>).<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">_next</span>, <span style="color:#a6e22e">_throw</span>); } }

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_asyncToGenerator</span>(<span style="color:#a6e22e">fn</span>) { <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">function</span> () { <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">self</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>, <span style="color:#a6e22e">args</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">arguments</span>; <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> Promise(<span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">resolve</span>, <span style="color:#a6e22e">reject</span>) { <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">gen</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">fn</span>.<span style="color:#a6e22e">apply</span>(<span style="color:#a6e22e">self</span>, <span style="color:#a6e22e">args</span>); <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_next</span>(<span style="color:#a6e22e">value</span>) { <span style="color:#a6e22e">asyncGeneratorStep</span>(<span style="color:#a6e22e">gen</span>, <span style="color:#a6e22e">resolve</span>, <span style="color:#a6e22e">reject</span>, <span style="color:#a6e22e">_next</span>, <span style="color:#a6e22e">_throw</span>, <span style="color:#e6db74">&#34;next&#34;</span>, <span style="color:#a6e22e">value</span>); } <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_throw</span>(<span style="color:#a6e22e">err</span>) { <span style="color:#a6e22e">asyncGeneratorStep</span>(<span style="color:#a6e22e">gen</span>, <span style="color:#a6e22e">resolve</span>, <span style="color:#a6e22e">reject</span>, <span style="color:#a6e22e">_next</span>, <span style="color:#a6e22e">_throw</span>, <span style="color:#e6db74">&#34;throw&#34;</span>, <span style="color:#a6e22e">err</span>); } <span style="color:#a6e22e">_next</span>(<span style="color:#66d9ef">undefined</span>); }); }; }

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">abc</span>() {
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">_abc</span>.<span style="color:#a6e22e">apply</span>(<span style="color:#66d9ef">this</span>, <span style="color:#a6e22e">arguments</span>);
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_abc</span>() {
  <span style="color:#a6e22e">_abc</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">_asyncToGenerator</span>( <span style="color:#75715e">/*#__PURE__*/</span><span style="color:#a6e22e">regeneratorRuntime</span>.<span style="color:#a6e22e">mark</span>(<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_callee</span>() {
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">regeneratorRuntime</span>.<span style="color:#a6e22e">wrap</span>(<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_callee$</span>(<span style="color:#a6e22e">_context</span>) {
      <span style="color:#66d9ef">while</span> (<span style="color:#ae81ff">1</span>) {
        <span style="color:#66d9ef">switch</span> (<span style="color:#a6e22e">_context</span>.<span style="color:#a6e22e">prev</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">_context</span>.<span style="color:#a6e22e">next</span>) {
          <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">:</span>
          <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;end&#34;</span><span style="color:#f92672">:</span>
            <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">_context</span>.<span style="color:#a6e22e">stop</span>();
        }
      }
    }, <span style="color:#a6e22e">_callee</span>);
  }));
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">_abc</span>.<span style="color:#a6e22e">apply</span>(<span style="color:#66d9ef">this</span>, <span style="color:#a6e22e">arguments</span>);
}
</code></pre></div><p>In this code, <code>_asyncToGenerator</code> is a helper function. It is responsible for converting the <code>abc</code> function to have async-like behavior. However, the issue with this approach is that the <code>_asyncToGenerator</code> function will be duplicated in every module that uses it.</p>
<p>To address this, <code>babel-plugin-transform-runtime</code> provides support. After adding it (following the configuration for Polyfills mentioned earlier), <code>transform-runtime</code> will convert the code to use imports, which effectively reduces code duplication:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#e6db74">&#34;use strict&#34;</span>;

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">_interopRequireDefault</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#34;@babel/runtime/helpers/interopRequireDefault&#34;</span>);

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">_regenerator</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">_interopRequireDefault</span>(<span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#34;@babel/runtime/regenerator&#34;</span>));

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">_asyncToGenerator2</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">_interopRequireDefault</span>(<span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#34;@babel/runtime/helpers/asyncToGenerator&#34;</span>));

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">abc</span>() {
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">_abc</span>.<span style="color:#a6e22e">apply</span>(<span style="color:#66d9ef">this</span>, <span style="color:#a6e22e">arguments</span>);
}

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_abc</span>() {
  <span style="color:#a6e22e">_abc</span> <span style="color:#f92672">=</span> (<span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">_asyncToGenerator2</span>.<span style="color:#66d9ef">default</span>)( <span style="color:#75715e">/*#__PURE__*/</span><span style="color:#a6e22e">_regenerator</span>.<span style="color:#66d9ef">default</span>.<span style="color:#a6e22e">mark</span>(<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_callee</span>() {
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">_regenerator</span>.<span style="color:#66d9ef">default</span>.<span style="color:#a6e22e">wrap</span>(<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_callee$</span>(<span style="color:#a6e22e">_context</span>) {
      <span style="color:#66d9ef">while</span> (<span style="color:#ae81ff">1</span>) {
        <span style="color:#66d9ef">switch</span> (<span style="color:#a6e22e">_context</span>.<span style="color:#a6e22e">prev</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">_context</span>.<span style="color:#a6e22e">next</span>) {
          <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">:</span>
          <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;end&#34;</span><span style="color:#f92672">:</span>
            <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">_context</span>.<span style="color:#a6e22e">stop</span>();
        }
      }
    }, <span style="color:#a6e22e">_callee</span>);
  }));
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">_abc</span>.<span style="color:#a6e22e">apply</span>(<span style="color:#66d9ef">this</span>, <span style="color:#a6e22e">arguments</span>);
}
</code></pre></div><p>Reference: <a href="https://babeljs.io/docs/en/babel-plugin-transform-runtime">https://babeljs.io/docs/en/babel-plugin-transform-runtime</a></p>
<h2 id="regenerator">Regenerator</h2>
<p>Please checkout MDN for details about Regenerator. <code>regeneratorRuntime</code> addresses the issue of polluting the global namespace:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#66d9ef">function</span><span style="color:#f92672">*</span> <span style="color:#a6e22e">foo</span>() {}
</code></pre></div><p>will produce:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#e6db74">&#34;use strict&#34;</span>;

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">_marked</span> <span style="color:#f92672">=</span> [<span style="color:#a6e22e">foo</span>].<span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">regeneratorRuntime</span>.<span style="color:#a6e22e">mark</span>);

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">foo</span>() {
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">regeneratorRuntime</span>.<span style="color:#a6e22e">wrap</span>(
    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">foo$</span>(<span style="color:#a6e22e">_context</span>) {
      <span style="color:#66d9ef">while</span> (<span style="color:#ae81ff">1</span>) {
        <span style="color:#66d9ef">switch</span> ((<span style="color:#a6e22e">_context</span>.<span style="color:#a6e22e">prev</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">_context</span>.<span style="color:#a6e22e">next</span>)) {
          <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">:</span>
          <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;end&#34;</span><span style="color:#f92672">:</span>
            <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">_context</span>.<span style="color:#a6e22e">stop</span>();
        }
      }
    },
    <span style="color:#a6e22e">_marked</span>[<span style="color:#ae81ff">0</span>],
    <span style="color:#66d9ef">this</span>
  );
}
</code></pre></div><p>However, since <code>regeneratorRuntime</code> is a global variable, it can cause pollution. After using <code>transform-runtime</code>, it will change to a method that does not pollute the global namespace:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#e6db74">&#34;use strict&#34;</span>;

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">_regenerator</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#34;@babel/runtime/regenerator&#34;</span>);

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">_regenerator2</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">_interopRequireDefault</span>(<span style="color:#a6e22e">_regenerator</span>);

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">_interopRequireDefault</span>(<span style="color:#a6e22e">obj</span>) {
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">__esModule</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">:</span> { <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">obj</span> };
}

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">_marked</span> <span style="color:#f92672">=</span> [<span style="color:#a6e22e">foo</span>].<span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">_regenerator2</span>.<span style="color:#66d9ef">default</span>.<span style="color:#a6e22e">mark</span>);

<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">foo</span>() {
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">_regenerator2</span>.<span style="color:#66d9ef">default</span>.<span style="color:#a6e22e">wrap</span>(
    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">foo$</span>(<span style="color:#a6e22e">_context</span>) {
      <span style="color:#66d9ef">while</span> (<span style="color:#ae81ff">1</span>) {
        <span style="color:#66d9ef">switch</span> ((<span style="color:#a6e22e">_context</span>.<span style="color:#a6e22e">prev</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">_context</span>.<span style="color:#a6e22e">next</span>)) {
          <span style="color:#66d9ef">case</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">:</span>
          <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;end&#34;</span><span style="color:#f92672">:</span>
            <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">_context</span>.<span style="color:#a6e22e">stop</span>();
        }
      }
    },
    <span style="color:#a6e22e">_marked</span>[<span style="color:#ae81ff">0</span>],
    <span style="color:#66d9ef">this</span>
  );
}
</code></pre></div><p>Reference: <a href="https://babeljs.io/docs/en/babel-plugin-transform-runtime">https://babeljs.io/docs/en/babel-plugin-transform-runtime</a></p>
<h2 id="conclution">Conclution</h2>
<p>At this point, you might wonder which approach is better. Essentially, each method has its own use case, which is why Babel offers so many options. After all, if it weren&rsquo;t necessary, everyone would prefer the approach with the least complexity. Regarding usage scenarios, the official Rollup Babel plugin documentation provides an explanation of the settings for <code>babelHelpers</code>:</p>
<blockquote>
<ul>
<li>&lsquo;runtime&rsquo; - you should use this especially when building libraries with Rollup. It has to be used in combination with @babel/plugin-transform-runtime and you should also specify @babel/runtime as dependency of your package. Don&rsquo;t forget to tell Rollup to treat the helpers imported from within the @babel/runtime module as external dependencies when bundling for cjs &amp; es formats. This can be accomplished via regex (external: [/@babel/runtime/]) or a function (external: id =&gt; id.includes('@babel/runtime')). It&rsquo;s important to not only specify external: ['@babel/runtime'] since the helpers are imported from nested paths (e.g @babel/runtime/helpers/get) and Rollup will only exclude modules that match strings exactly.</li>
<li>&lsquo;bundled&rsquo; - you should use this if you want your resulting bundle to contain those helpers (at most one copy of each). Useful especially if you bundle an application code.</li>
<li>&lsquo;external&rsquo; - use this only if you know what you are doing. It will reference helpers on global babelHelpers object. Used in combination with @babel/plugin-external-helpers.</li>
<li>&lsquo;inline&rsquo; - this is not recommended. Helpers will be inserted in each file using this option. This can cause serious code duplication. This is the default Babel behavior as Babel operates on isolated files - however, as Rollup is a bundler and is project-aware (and therefore likely operating across multiple input files), the default of this plugin is &ldquo;bundled&rdquo;.</li>
</ul>
</blockquote>
<p>In short, if you are developing a library, it is generally recommended to use the <code>transform-runtime</code> approach. If you are developing an application, it is recommended to use the <code>bundled</code> approach provided by Rollup, which essentially combines all <code>helpers</code> into a single version. My own guess is that, theoretically, it will add a scope at the application level to ensure that it only applies to and affects the application layer.</p>

</div>

  
<footer class='entry-footer'>
  <div class='container sep-before'><div class='categories'><svg class='icon' xmlns='http://www.w3.org/2000/svg' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    
    <path d="M22,19a2,2,0,0,1-2,2H4a2,2,0,0,1-2-2V5A2,2,0,0,1,4,3H9l2,3h9a2,2,0,0,1,2,2Z"/>

</svg>
<span class='screen-reader-text'>Categories: </span><a class='category' href='/en/categories/coding/'>Coding</a></div>
<div class='tags'><svg class='icon' xmlns='http://www.w3.org/2000/svg' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    
  <path d="M20.59,13.41l-7.17,7.17a2,2,0,0,1-2.83,0L2,12V2H12l8.59,8.59A2,2,0,0,1,20.59,13.41Z"/>
  <line x1="7" y1="7" x2="7" y2="7"/>

</svg>
<span class='screen-reader-text'>Tags: </span><a class='tag' href='/en/tags/javascript/'>javascript</a>, <a class='tag' href='/en/tags/babel/'>babel</a>, <a class='tag' href='/en/tags/polyfill/'>polyfill</a>, <a class='tag' href='/en/tags/es6/'>es6</a>, <a class='tag' href='/en/tags/plugin-transform-runtime/'>plugin-transform-runtime</a></div>

  </div>
</footer>


</article>

<nav class='entry-nav'>
  <div class='container'><div class='next-entry sep-before'>
      <a href='/en/coding/reunderstanding-javascript-event-loop/'>
        <span class='screen-reader-text'>Next post: </span>Reunderstanding Javascript&#39;s Event Loop<span aria-hidden='true'>Next <svg class='icon' xmlns='http://www.w3.org/2000/svg' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    
  <line x1="4" y1="12" x2="20" y2="12"/>
  <polyline points="14 6 20 12 14 18"/>

</svg>
</span>
      </a>
    </div></div>
</nav>


<section id='comments' class='comments'>
  <div class='container sep-before'>
    <div class='comments-area'><script src='https://utteranc.es/client.js'
  repo='garyyeap/blog'
  issue-term='pathname'
  
  
  crossorigin='anonymous' async>
</script>
</div>
  </div>
</section>

      </main>

      <footer id='footer' class='footer'>
        <div class='container sep-before'><section class='widget widget-social_menu sep-after'><nav aria-label='Social Menu'>
    <ul><li>
        <a href='https://github.com/garyyeap' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Open Github account in new tab</span><svg class='icon' xmlns='http://www.w3.org/2000/svg' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    
      <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>

</svg>
</a>
      </li><li>
        <a href='https://twitter.com/curryyeap' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Open Twitter account in new tab</span><svg class='icon' xmlns='http://www.w3.org/2000/svg' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    
  <title>Twitter icon</title>
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>

</svg>
</a>
      </li><li>
        <a href='mailto:contact@garyyeap.com' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Contact via Email</span><svg class='icon' xmlns='http://www.w3.org/2000/svg' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline>
</svg>
</a>
      </li><li>
        <a href='https://linkedin.com/in/garyyeap' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Open Linkedin account in new tab</span><svg class='icon' xmlns='http://www.w3.org/2000/svg' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle>
</svg>
</a>
      </li></ul>
  </nav>
</section><div class='copyright'>
  <p> <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> 2019-2024 Gary Yeap </p>
</div>

        </div>
      </footer>

    </div>
  </div><script>window.__assets_js_src="/assets/js/"</script>

<script src='/assets/js/main.5f629e73.js'></script>

</body>

</html>

